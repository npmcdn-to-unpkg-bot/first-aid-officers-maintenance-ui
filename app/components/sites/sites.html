<div st-persist="sites" st-table="shown" st-safe-src="sites">
	<form class="form-inline row">
		<div class="form-group col-md-4">
			<label for="pageSize">Sites par page :&nbsp;</label>
			<select class="form-control" id="pageSize" ng-model="pageSize" ng-init="pageSize = 25" ng-options="size for size in [5, 10, 25, 100]"></select>
		</div>
		<div class="col-md-6 col-md-offset-2 text-right">
			<div class="form-group is-empty">
				<div class="input-group">
					<span class="input-group-addon">Consulter la fiche d'un site</span>
					<input type="text" class="form-control"	ng-model="viewSite" placeholder="Rechercher..." class="form-control" uib-typeahead="viewSite as viewSite.site_name for viewSite in sitesIndex | filterSite:$viewValue | limitTo:8" />
				</div>
			</div>
		</div>
	</form>

	<div class="panel panel-primary">
		<div class="panel-heading">
			<div class="row">
				<div class="col-md-2">Sites</div>
				<div class="col-md-10 text-right">
					<state-sustain items="certificates" items-id="cert_short" state="checked" state-id="certificates_checked">
						<div class="btn-group">
						    <label class="btn btn-raised btn-default btn-sm" ng-model="cert.checked" uib-btn-checkbox ng-repeat="cert in certificates" tooltip="{{cert.cert_name}}">{{cert.cert_short}}</label>
						</div>
					</state-sustain>
				</div>
			</div>
		</div>
		<table class="table table-striped table-hover">
			<thead>
				<tr>
					<th class="vtop"></th>
					<th width="50%">
						<div class="st-sort" st-sort="site_name" st-skip-natural="true">Nom</div>
						<input st-search="site_name" placeholder="Rechercher..." class="form-control" type="text" />
					</th>
					<th width="50%">
						<div class="st-sort" st-sort="dept.dept_name" st-skip-natural="true">D&eacute;partement</div>
						<input st-search="dept.dept_name" placeholder="Rechercher..." class="form-control" type="text" />
					</th>
					<th class="last vtop" ng-repeat="cert in certificates | filter: {'checked': true}">
						<div class="st-sort" st-sort="stats.certificates[{{cert.cert_pk}}].countPercentage" st-skip-natural="true">{{cert.cert_short}}</div>
					</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="site in shown" ng-click="select(site.site_pk);" class="clickme" ng-mouseenter="hover=true" ng-mouseleave="hover = false">
					<td><button type="button" class="btn btn-primary btn-xs" ng-disabled="!hover">VOIR</button></td>
					<td class="shrinkable" ng-class="{'text-primary': hover}">{{ site.site_name }}</td>
					<td class="shrinkable">{{ site.dept.dept_name }}</td>
					<td class="shrinkable text-center" ng-repeat="cert in certificates | filter: {'checked': true}" ng-init="certStats = site.stats.certificates[cert.cert_pk]">
						<span class="label" ng-class="'label-' + certStats.targetStatus">{{certStats.countPercentage}}%</span>
					</td>
				</tr>
			</tbody>
		</table>
		
		<div class="panel-footer text-center">
			<td colspan="5" class="text-center">
				<div st-pagination="" st-items-by-page="pageSize" st-displayed-pages="7"></div>
			</td>
			<!-- <nav>
				<ul class="pagination">
					<li ng-click="offset = 0" ng-class="{'disabled': offset == 0}"><span>&laquo;</span></li>
					<li ng-click="decrementOffset()" ng-class="{'disabled': offset == 0}"><span>&lsaquo;</span></li>
					<li ng-repeat="offset in shownOffsets" ng-class="{'active': offset == $parent.offset}" ng-click="$parent.offset = offset;"><span>{{offset/pageSize}}</span></li>
					<li ng-click="incrementOffset()" ng-class="{'disabled': offset == lastOffset}"><span>&rsaquo;</span></li>
					<li ng-click="offset = lastOffset" ng-class="{'disabled': offset == lastOffset}"><span>&raquo;</span></li>
				</ul>
			</nav> -->
		</div>
	</div>
</div>
