<h3>Formations s&eacute;curit&eacute; - statistiques</h3>
<br />
<div class="row">
    <div class="col-md-8 col-md-offset-2">
        <div class="panel panel-primary">
            <div class="panel-heading">Param&egrave;tres</div>
            <div class="panel-body">
                <form class="form-horizontal" autocomplete="off">
                    <div class="form-group">
                        <label for="beginning" class="col-xs-4 control-label">D&eacute;but de p&eacute;riode</label>
                        <div class="col-xs-8">
                            <input id="beginning" type="text" max-date="end" ng-model="beginning" class="form-control" ng-click="startpicker=true" uib-datepicker-popup="fullDate" datepicker-mode="'year'" is-open="startpicker" show-button-bar="false" starting-day="1" date-disabled="disabled(date, mode)" show-weeks="false">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="end" class="col-xs-4 control-label">Fin de p&eacute;riode</label>
                        <div class="col-xs-8">
                            <input id="end" type="text" min-date="beginning || null" ng-model="end" class="form-control" ng-click="datepicker=true" uib-datepicker-popup="fullDate" datepicker-mode="'year'" is-open="datepicker" show-button-bar="false" starting-day="1" date-disabled="disabled(date, mode)" show-weeks="false">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="interval" class="col-xs-4 control-label">Bilans interm&eacute;diaires</label>
                        <div class="col-xs-8">
                            <select id="interval" class="form-control" ng-model="interval" ng-options="interval as 'sur chaque ' + getIntervalDisplay(interval) for interval in availableIntervals" ng-change="interval ? intervals.push(interval) : ''">
                                <option value="" disabled selected="true">Ajouter bilans interm&eacute;diaires...</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-xs-4"></div>
                        <div class="col-xs-8">
                            <div ng-repeat="interval in intervals | orderBy" class="pill clickme" ng-click="intervals.splice(intervals.indexOf(interval), 1)">
                                <small>sur chaque {{getIntervalDisplay(interval)}}<span class="pill-delete">&times;</span></small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="panel-footer text-center">
                <button type="button" class="btn btn-primary" ng-click="generate()" ng-disabled="!beginning || !end">Dresser statistiques</button>
            </div>
        </div>
    </div>
</div>
<div class="panel panel-primary" ng-if="stats">
    <div class="panel-heading">
        <div class="row">
            <div class="col-sm-4 col-xs-12">Statistiques</div>
            <div class="col-sm-8 col-xs-12 text-right">
                <state-sustain items="certificates" items-id="cert_short" state="checked" state-id="certificates_checked">
                    <div class="btn-group">
                        <label class="btn btn-raised btn-default btn-sm" ng-model="cert.checked" uib-btn-checkbox ng-repeat="cert in certificates" tooltip="{{cert.cert_name}}">{{cert.cert_short}}</label>
                    </div>
                </state-sustain>
            </div>
        </div>
    </div>
    <table class="table table-striped table-hover trainings-stats">
        <tbody ng-repeat="intervalStats in stats">
            <tr>
                <th class="text-center">{{intervalStats.interval !== 0 ? 'par' : 'sur la'}} {{getIntervalDisplay(intervalStats.interval)}}</th>
                <th class="text-center" ng-repeat="col in intervalStats.stats" colspan="{{$last && columns % intervalStats.colSpan ? 1 : intervalStats.colSpan || columns}}">
                    {{getDatesRangeDisplay(intervalStats.interval, col.beginning, col.end)}}
                </th>
            </tr>
            <tr ng-repeat="(certPk, cert) in certificates" ng-if="cert.checked">
                <td class="text-right">{{cert.cert_name}}</td>
                <td class="text-center" ng-repeat="col in intervalStats.stats" colspan="{{$last && columns % intervalStats.colSpan ? 1 : intervalStats.colSpan || columns}}">
                    <abbr title="{{col.certificates[certPk].employeesRegistered || 0}} {{cert.cert_short}} form&eacute;(s) sur cette p&eacute;riode" class="text-success">+&nbsp;{{col.certificates[certPk].employeesRegistered || 0}}</abbr> /
                    <abbr title="{{col.certificates[certPk].employeesExpired || 0}} {{cert.cert_short}} &agrave; renouveller sur cette p&eacute;riode" class="text-danger">-&nbsp;{{col.certificates[certPk].employeesExpired || 0}}</abbr>
                </td>
            </tr>
        </tbody>
    </table>
</div>
